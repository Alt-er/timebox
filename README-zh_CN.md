# Timebox

> è®©æ¯ä¸ªå±å¹•ç¬é—´éƒ½æˆä¸ºè§¦æ‰‹å¯åŠçš„è®°å¿†  

Timebox æ˜¯ä¸€æ¬¾å¼€æºçš„å±å¹•è®°å½•ä¸æ£€ç´¢å·¥å…·ï¼Œåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚å®¢æˆ·ç«¯æŒ‰å›ºå®šæ—¶é—´é¢‘ç‡è‡ªåŠ¨æˆªå–å±å¹•å¹¶å°†æˆªå›¾ä¸Šä¼ è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¯¹æˆªå›¾è¿›è¡Œå­˜å‚¨å’Œ OCRï¼ˆæ–‡å­—è¯†åˆ«ï¼‰å¤„ç†ï¼Œæ”¯æŒåŸºäºæ—¶é—´èŒƒå›´å’Œæ–‡å­—å†…å®¹çš„å¿«é€Ÿæ£€ç´¢ã€‚é€šè¿‡ Timeboxï¼Œç”¨æˆ·å¯ä»¥è½»æ¾å›æº¯å¹¶å¿«é€Ÿæ‰¾åˆ°è¿‡å¾€çš„è®°å½•ï¼Œæ„å»ºä¸€ä¸ªå±äºè‡ªå·±çš„â€œå±å¹•ç¬é—´æœç´¢å¼•æ“â€ã€‚

![Timebox image 1](images/image_1.png)

![Timebox image 2](images/image_2.png)

---

## åŠŸèƒ½ç‰¹è‰²

- ğŸ–¥ï¸ **å…¨å±å¹•æˆªå›¾**ï¼šå®¢æˆ·ç«¯å®šæ—¶æˆªå–å±å¹•ï¼Œè‡ªåŠ¨ä¸Šä¼ è‡³æœåŠ¡ç«¯ã€‚
- ğŸ” **æ–‡å­—æ£€ç´¢**ï¼šé€šè¿‡ OCR è¯†åˆ«æˆªå›¾ä¸­çš„æ–‡å­—ï¼Œå¹¶å­˜å‚¨åˆ° PostgreSQL æ•°æ®åº“ä¸­ï¼Œæ”¯æŒæ–‡å­—å†…å®¹æ£€ç´¢ã€‚
- ğŸ“… **æ—¶é—´ç­›é€‰**ï¼šæ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ç­›é€‰æˆªå›¾ï¼Œå¿«é€Ÿå®šä½ç›®æ ‡è®°å½•ã€‚
- ğŸŒ **æœåŠ¡ç«¯ç½‘é¡µæ£€ç´¢**ï¼šæä¾›ç›´è§‚çš„ Web ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·æ£€ç´¢å’ŒæŸ¥çœ‹æˆªå›¾ã€‚
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–å­˜å‚¨**ï¼šæœåŠ¡ç«¯å¯¹æˆªå›¾å’Œ OCR æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç®¡ç†ï¼Œæ”¯æŒé•¿æ—¶é—´çš„å†å²è®°å½•å›æº¯ã€‚
- ğŸš€ **å¼€æºä¸å¯æ‰©å±•**ï¼šå®Œå…¨å¼€æºï¼Œæ”¯æŒä¸ªæ€§åŒ–éƒ¨ç½²ä¸åŠŸèƒ½æ‰©å±•ã€‚

---

## é¡¹ç›®çµæ„Ÿä¸åŒºåˆ«

Timebox çš„çµæ„Ÿæ¥æºäºä»¥ä¸‹é¡¹ç›®ï¼š

- [Pensieve](https://github.com/arkohut/pensieve)  

ä¸¤è€…å­˜åœ¨ä»¥ä¸‹å…³é”®åŒºåˆ«ï¼š

| åŠŸèƒ½            | Pensieve                  | Timebox                        |
|-----------------|--------------------------|--------------------------------|
| æ•°æ®å­˜å‚¨æ–¹å¼     | æœ¬åœ°å­˜å‚¨                  | æœåŠ¡ç«¯é›†ä¸­å­˜å‚¨ï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯  |
| OCR å¤„ç†         | å®¢æˆ·ç«¯å®Œæˆ(å¯æœåŠ¡ç«¯)      | æœåŠ¡ç«¯ç»Ÿä¸€å¤„ç†(å¯é›†ç¾¤)                |
| æ£€ç´¢æ–¹å¼         | æœ¬åœ°æ£€ç´¢                  | æœåŠ¡ç«¯æä¾›ç½‘é¡µæ£€ç´¢åŠŸèƒ½        |
| æ¶æ„è®¾è®¡         | å¯å®¢æˆ·ç«¯ç‹¬ç«‹è¿è¡Œ            | å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åˆ†ç¦»                |

Timebox æä¾›äº†æ›´å¼ºå¤§çš„æœåŠ¡ç«¯æ”¯æŒï¼Œé€‚åˆéœ€è¦é›†ä¸­ç®¡ç†å’Œæ£€ç´¢å¤§è§„æ¨¡æˆªå›¾æ•°æ®çš„åœºæ™¯ã€‚

---

## å®‰è£…æŒ‡å—  

### å®¢æˆ·ç«¯å®‰è£…  

Timebox å®¢æˆ·ç«¯æ”¯æŒ **macOS** å’Œ **Windows** å¹³å°ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œå®‰è£…ï¼š  

1. å‰å¾€ [Timebox Release é¡µé¢](https://github.com/Alt-er/timebox/releases) ä¸‹è½½é€‚åˆæ‚¨ç³»ç»Ÿçš„å®¢æˆ·ç«¯å®‰è£…åŒ…ï¼š  
   - macOS ç”¨æˆ·è¯·ä¸‹è½½åç¼€ä¸º `.dmg` çš„æ–‡ä»¶ã€‚  
   - Windows ç”¨æˆ·è¯·ä¸‹è½½åç¼€ä¸º `.exe` çš„æ–‡ä»¶ã€‚  
2. æŒ‰ç…§å¹³å°æŒ‡å¼•å®‰è£…ï¼š  
   - macOSï¼šåŒå‡» `.dmg` æ–‡ä»¶å¹¶å°† Timebox æ‹–æ‹½è‡³åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ã€‚  
   - Windowsï¼šåŒå‡» `.exe` æ–‡ä»¶å¹¶æŒ‰ç…§å®‰è£…å‘å¯¼å®Œæˆå®‰è£…ã€‚  
3. å®‰è£…å®Œæˆåï¼Œå¯åŠ¨å®¢æˆ·ç«¯å¹¶æŸ¥çœ‹ç³»ç»Ÿæ‰˜ç›˜(windows)æˆ–è€…èœå•æ (macOS)æ˜¯å¦æœ‰ Timebox å›¾æ ‡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚
4. å¯åŠ¨å®¢æˆ·ç«¯åï¼Œç‚¹å‡»è®¾ç½®è¿›è¡ŒæœåŠ¡ç«¯é…ç½®(éœ€è¦å…ˆé…ç½®å¥½æœåŠ¡ç«¯)ã€‚
5. é…ç½®å®Œæˆåï¼Œç‚¹å‡»`å¼€å§‹è®°å½•`æŒ‰é’®ï¼Œå®¢æˆ·ç«¯ä¼šå¼€å§‹è‡ªåŠ¨æˆªå–å±å¹•å¹¶ä¸Šä¼ è‡³æœåŠ¡ç«¯ã€‚


### æœåŠ¡ç«¯éƒ¨ç½²  

Timebox æœåŠ¡ç«¯æ”¯æŒ **Linux**ã€**macOS** å’Œ **Windows** å¹³å°ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€è¿›è¡Œéƒ¨ç½²ï¼š  

> OCR æœåŠ¡æ”¯æŒä»¥ä¸‹è¿è¡Œæ¨¡å¼ï¼š

| ç¼–å· | éƒ¨ç½²æ–¹å¼ | æ“ä½œç³»ç»Ÿ | CPU æ¨¡å¼ | GPU æ¨¡å¼ | å¤‡æ³¨ |
|-----|---------|---------|----------|-----------|------|
| 1 | Docker | Linux   | âœ“ æ”¯æŒ   | âœ“ æ”¯æŒ CUDA | éœ€è¦ NVIDIA æ˜¾å¡å’Œé©±åŠ¨ï¼Œå¯é€šè¿‡ nvidia-smi å‘½ä»¤æ£€æŸ¥ |
| 2 | Docker | Windows | âœ“ æ”¯æŒ   | âœ“ æ”¯æŒ CUDA | éœ€ä½¿ç”¨ WSL2 + Dockerï¼Œæ”¯æŒ NVIDIA æ˜¾å¡ |
| 3 | æ‰‹åŠ¨éƒ¨ç½² | Windows | âœ“ æ”¯æŒ   | âœ“ æ”¯æŒ DirectML | æ”¯æŒå¤šç§æ˜¾å¡ï¼ŒåŒ…æ‹¬ NVIDIAã€AMDã€Intel |
| 4 | æ‰‹åŠ¨éƒ¨ç½² | macOS   | âœ“ æ”¯æŒ   | âœ“ æ”¯æŒ MPS | æ”¯æŒ Apple Silicon å’Œ Intel èŠ¯ç‰‡ï¼Œè‡ªåŠ¨å¯ç”¨ GPU åŠ é€Ÿ |
| 5 | æ‰‹åŠ¨éƒ¨ç½² | Linux   | âœ“ æ”¯æŒ   | âœ“ æ”¯æŒ CUDA | éœ€è¦ NVIDIA æ˜¾å¡å’Œé©±åŠ¨ |

#### æ–¹å¼ 1ï¼šä½¿ç”¨ Docker éƒ¨ç½²

> windowsç³»ç»Ÿè¯·è¿›å…¥wslç¯å¢ƒåæ‰§è¡Œ, éœ€è¦å®‰è£…wsl2å’Œdocker desktop

##### 1. åˆ›å»ºå¹¶è¿›å…¥é¡¹ç›®ç›®å½•
```bash
mkdir timebox
cd timebox
```

##### 2. ä¸‹è½½é…ç½®æ–‡ä»¶
```bash
# ä¸‹è½½ç¯å¢ƒé…ç½®æ–‡ä»¶
curl https://raw.githubusercontent.com/Alt-er/timebox/main/.env.example -o .env
# ä¸‹è½½docker-composeé…ç½®æ–‡ä»¶
curl https://raw.githubusercontent.com/Alt-er/timebox/main/docker-compose.yml -o docker-compose.yml
```

##### 3. é…ç½®ä¸å¯åŠ¨
```bash
# ç¼–è¾‘ç¯å¢ƒé…ç½®æ–‡ä»¶
vi .env

# åœ¨ç¼–è¾‘ç¯å¢ƒé…ç½®æ–‡ä»¶æ—¶ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ï¼š

# TZ: æ—¶åŒºè®¾ç½®ï¼Œé»˜è®¤ä¸º Asia/Shanghai

# æ•°æ®åº“ç›¸å…³é…ç½®
# POSTGRES_USER: PostgreSQLæ•°æ®åº“ç”¨æˆ·å
# POSTGRES_PASSWORD: PostgreSQLæ•°æ®åº“å¯†ç 
# POSTGRES_DB: PostgreSQLæ•°æ®åº“åç§°
# POSTGRES_PORT: PostgreSQLæ•°æ®åº“ç«¯å£å·ï¼Œé»˜è®¤5432

# ç½‘é¡µç®¡ç†ç›¸å…³é…ç½®
# SECRET_KEY: sessionåŠ å¯†ä½¿ç”¨çš„keyï¼Œå»ºè®®ä½¿ç”¨éšæœºå­—ç¬¦ä¸²ï¼ŒåŠ¡å¿…ä¿®æ”¹é»˜è®¤å€¼
# DEFAULT_USERNAME: è®¾ç½®é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·åï¼Œç”¨äºç™»å½•æœåŠ¡ç«¯ç½‘é¡µ
# DEFAULT_PASSWORD: è®¾ç½®é»˜è®¤ç®¡ç†å‘˜å¯†ç ï¼Œç”¨äºç™»å½•æœåŠ¡ç«¯ç½‘é¡µ

# OCRæœåŠ¡é…ç½®
# OCR_CONCURRENT_LIMIT: æœ€å¤§å¹¶å‘OCRä»»åŠ¡æ•°ï¼Œæ ¹æ®æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´
# OCR_SERVICE_URLS: OCRæœåŠ¡åœ°å€ï¼Œå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”
# OCR_API_TOKEN: OCRæœåŠ¡è®¤è¯ä»¤ç‰Œï¼Œç¡®ä¿core-serviceå’Œocr-serviceä¸­çš„å€¼ä¸€è‡´
# USE_CUDA: æ˜¯å¦å¯ç”¨CUDA GPUåŠ é€Ÿï¼ˆéœ€è¦NVIDIAæ˜¾å¡ï¼‰ï¼Œæ³¨é‡Šä¸å¯ç”¨, è®¾ç½®ä¸ºtrueå¯ç”¨
# USE_DML: æ˜¯å¦å¯ç”¨DirectML GPUåŠ é€Ÿï¼ˆä»…Windowsç³»ç»Ÿæ”¯æŒï¼‰ï¼Œtrue/falseï¼Œé»˜è®¤false
# OCR_NUM_WORKERS: OCRæœåŠ¡å·¥ä½œè¿›ç¨‹æ•°
# OCR_SERVICE_TOKENS: OCRæœåŠ¡è®¤è¯ä»¤ç‰Œåˆ—è¡¨ï¼Œå¤šä¸ªä»¤ç‰Œç”¨é€—å·åˆ†éš”ï¼Œå¿…é¡»ä¸core-serviceä¸­çš„OCR_API_TOKENåŒ¹é…

# ç¤ºä¾‹é…ç½®æ–‡ä»¶å†…å®¹ï¼š

# éƒ¨ç½²æ–¹å¼1 å’Œ éƒ¨ç½²æ–¹å¼2çš„é…ç½®æ˜¯ä¸€æ ·çš„, åŒºåˆ«æ˜¯windowsç¯å¢ƒéœ€è¦æå‰è£…å¥½wsl2å’Œdocker desktop, ç„¶ååœ¨wslç¯å¢ƒä¸­æ‰§è¡Œdockerå‘½ä»¤, æœ¬è´¨ä¸Šéƒ½æ˜¯linux
SECRET_KEY=11111111111111
DEFAULT_USERNAME=admin
DEFAULT_PASSWORD=admin
USE_CUDA=true   # å¦‚æœæœ‰cudaåŠ é€Ÿ, è¯·è®¾ç½®ä¸ºtrue, å¦åˆ™ä¸è¦è¿™ä¸€è¡Œ, ä¸èƒ½è®¾ç½®ä¸ºfalse

# å¯åŠ¨æœåŠ¡
docker compose up -d
```
##### 4. è®¿é—®æœåŠ¡
è®¿é—®`http://{æœåŠ¡ç«¯IP}:8000/timebox`å³å¯è®¿é—®æœåŠ¡ç«¯ç½‘é¡µã€‚è¯·åœ¨å®¢æˆ·ç«¯ä¸­é…ç½®`http://{æœåŠ¡ç«¯IP}:8000`è¿™ä¸ªåœ°å€ã€‚

#### æ–¹å¼ 2ï¼šæ‰‹åŠ¨éƒ¨ç½²

> æ³¨æ„ï¼šæ‰‹åŠ¨éƒ¨ç½²æ–¹å¼æ”¯æŒ CPU å’Œ GPU æ¨¡å¼è¿è¡Œ OCR æœåŠ¡ã€‚
> 
> macOS ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ GPU åŠ é€Ÿæ— éœ€é¢å¤–é…ç½®ï¼ŒWindows ç³»ç»Ÿéœ€è¦æ‰‹åŠ¨é…ç½® DML æ¨¡å¼æ‰èƒ½ä½¿ç”¨ GPUã€‚
> 
> å¯åœ¨ macOS æˆ– Windows ç³»ç»Ÿä¸Šæ‰‹åŠ¨éƒ¨ç½² OCR æœåŠ¡ã€‚å…¶ä½™æœåŠ¡ä½¿ç”¨ Docker éƒ¨ç½²ã€‚

##### 1. å®‰è£… Miniconda ä¸ PostgreSQL
- è®¿é—® [Minicondaå®˜æ–¹æ–‡æ¡£](https://docs.anaconda.com/miniconda/install/#quick-command-line-install) è·å–å®‰è£…æŒ‡å—
- è®¿é—® [PostgreSQL 16/17 ä¸‹è½½é¡µé¢](https://www.postgresql.org/download/) å®‰è£… PostgreSQL 16 æˆ– 17 ç‰ˆæœ¬

##### 2. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/Alt-er/timebox
cd timebox
```

##### 3. OCRæœåŠ¡é…ç½®
```bash
# åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
conda create -n ocr-service python=3.12
conda activate ocr-service

# è¿›å…¥ocr-serviceç›®å½•
cd timebox/server/ocr-service

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
# å®‰è£…ä¾èµ– ä½¿ç”¨æ¸…åæºå®‰è£…
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

```

##### OpenVINO CPU æ¨¡å¼è¿è¡Œ(å¯é€‰ï¼Œä»…æ”¯æŒIntel CPU)
```bash
# Intel CPU 
pip install rapidocr-openvino 
# Intel CPU ä½¿ç”¨æ¸…åæºå®‰è£…
pip install rapidocr-openvino -i https://pypi.tuna.tsinghua.edu.cn/simple

```

###### DirectML GPU æ¨¡å¼è¿è¡Œ(å¯é€‰ï¼Œä»…æ”¯æŒWindows)
```bash
# åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
echo USE_DML=true > .env

# åˆ‡æ¢åˆ°DirectMLåç«¯
pip uninstall onnxruntime
pip install onnxruntime-directml
# ä½¿ç”¨æ¸…åæºå®‰è£…
pip install onnxruntime-directml -i https://pypi.tuna.tsinghua.edu.cn/simple

```
###### ä¿®æ”¹é…ç½®
```bash
# åˆ›å»º.envæ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶
vi .env
```

###### è¿è¡ŒOCRæœåŠ¡
```bash
python run.py
```

##### 4. CoreæœåŠ¡é…ç½®
```bash
conda create -n core-service python=3.12
conda activate core-service

# è¿›å…¥core-serviceç›®å½•
cd timebox/server/core-service

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
# å®‰è£…ä¾èµ– ä½¿ç”¨æ¸…åæºå®‰è£…
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```
###### ä¿®æ”¹é…ç½®
```bash
# åˆ›å»º.envæ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶
vi .env
```

###### è¿è¡ŒCoreæœåŠ¡
```bash
python run.py
```

##### 5. è®¿é—®æœåŠ¡
è®¿é—®`http://{æœåŠ¡ç«¯IP}:8000/timebox`å³å¯è®¿é—®æœåŠ¡ç«¯ç½‘é¡µã€‚è¯·åœ¨å®¢æˆ·ç«¯ä¸­é…ç½®`http://{æœåŠ¡ç«¯IP}:8000`è¿™ä¸ªåœ°å€ã€‚


#### Conda å¸¸ç”¨å‘½ä»¤
```bash
# è™šæ‹Ÿç¯å¢ƒæ˜¯ç”¨æ¥éš”ç¦»ä¸åŒé¡¹ç›®çš„ Python ç¯å¢ƒï¼Œé¿å…ä¾èµ–å†²çªã€‚

# é€€å‡ºå½“å‰è™šæ‹Ÿç¯å¢ƒ
conda deactivate

# æ¿€æ´»æŒ‡å®šè™šæ‹Ÿç¯å¢ƒ
conda activate ocr-service

# æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒ
conda env list

# åˆ é™¤æŒ‡å®šè™šæ‹Ÿç¯å¢ƒ
conda env remove -n ocr-service
```






